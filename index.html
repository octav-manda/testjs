<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Processing with TheCatAPI</title>
</head>
<body>
<h1>Procesare Imagini - TheCatAPI</h1>
<button id="process-button">Obține și procesează imaginea</button>
<div>
  <p><strong>Timp de procesare:</strong> <span id="processing-time">-</span> ms</p>
  <p><strong>Număr de accesări API:</strong> <span id="api-count">0</span></p>
</div>
<div id="json-output">
  <h3>Răspuns JSON:</h3>
  <pre id="json-console"></pre>
</div>
<canvas id="image-canvas" width="500" height="500" style="border: 1px solid black;"></canvas>

<script>
  const API_KEY = 'api_key=live_5X13Kyel2D8fx0TOcFVacO2U307RZVRX6FOJ3AncwBx4IUshWJA2MyNQZjyyKMml'; // Introduceți cheia API aici
  const API_URL = 'https://api.thecatapi.com/v1/images/search';
  let apiAccessCount = 0;

  document.getElementById('process-button').addEventListener('click', async () => {
    const startTime = performance.now();
    apiAccessCount++;

    try {
      // Obține date de la API
      const response = await fetch(API_URL, {
        headers: {
          'x-api-key': API_KEY
        }
      });

      if (!response.ok) throw new Error('Eroare la accesarea API-ului.');

      const data = await response.json();
      const imageUrl = data[0]?.url;

      // Afișare răspuns JSON
      document.getElementById('json-console').textContent = JSON.stringify(data, null, 2);

      // Prelucrare imagine
      const img = new Image();
      img.crossOrigin = 'Anonymous'; // Esențial pentru a evita problemele CORS
      img.src = imageUrl;

      img.onload = () => {
        const canvas = document.getElementById('image-canvas');
        const ctx = canvas.getContext('2d');

        // Setează dimensiunile canvasului conform imaginii
        canvas.width = img.width;
        canvas.height = img.height;

        // Rotește imaginea
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.translate(canvas.width / 2, canvas.height / 2);
        ctx.rotate(90 * Math.PI / 180); // Rotație 90 de grade
        ctx.drawImage(img, -img.width / 2, -img.height / 2);

        // Calculează timpul de procesare
        const endTime = performance.now();
        const processingTime = (endTime - startTime).toFixed(2);

        // Afișare rezultate
        document.getElementById('processing-time').textContent = processingTime;
        document.getElementById('api-count').textContent = apiAccessCount;
      };

      img.onerror = () => {
        console.error('Eroare la încărcarea imaginii.');
        alert('Nu s-a putut încărca imaginea. Verificați răspunsul JSON sau cheile API.');
      };
    } catch (error) {
      console.error('Eroare:', error.message);
      alert('A apărut o eroare. Verificați consola pentru detalii.');
    }
  });
</script>
</body>
</html>
